{
  "kind": "build_request",
  "title": "Add fake Premium subscription flow, in-app sharing, and daily notification simulation",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Implement a complete fake premium subscription flow that persists premium status locally and updates UI state across the app.\n\nScope:\n- Make the existing Premium entry point(s) navigable from both the side drawer “Premium” item and the Profile page button.\n- Update the Go Premium page UI/content to match:\n  - Benefits list exactly: \"No ads • Unlimited premium stories • Exclusive content • Daily exclusive story\".\n  - Pricing placeholders exactly: \"Monthly ₹99\" and \"Yearly ₹799\" (no real payments).\n  - \"Subscribe Now\" action that shows a dedicated success screen: \"Subscribed successfully! Enjoy premium features.\".\n- Persist premium state using existing user state persistence (guest localStorage and authenticated backend AppUser via useAppUser.updateUserState), using the existing `isPremium` field.\n- When premium is active:\n  - Show a crown icon or “Premium” badge next to the username in the side drawer and in the Profile page.\n  - Hide ad UI anywhere ads are rendered (continue to rely on the existing isPremium checks, and ensure any remaining ad banners are gated).\n  - Treat premium-only stories as unlocked: if a story is flagged/treated as premium-only in the UI, show a clear placeholder message like \"Premium unlocked\" instead of any lock UI.\n- Add a \"Cancel Subscription\" action in Profile that reverts the user to free (sets isPremium to false) and updates the badge/crown and ad visibility immediately.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "Update my Global Tales Universe app with three features: fake premium subscription... update status (local storage) to \"Premium\" (show crown icon or \"Premium\" badge next to username in drawer/Profile)... \"Cancel Subscription\" option in Profile to revert to free."
        ]
      },
      "acceptanceCriteria": [
        "From the AppDrawer “Premium” item and Profile “Go Premium” button, the user can reach the Go Premium page.",
        "Go Premium page displays the benefits string and the placeholder prices exactly as specified in English.",
        "Tapping \"Subscribe Now\" shows a success screen with the exact success message and sets `isPremium=true` via the existing user-state persistence path (guest localStorage and authenticated backend save).",
        "After subscribing, AppDrawer and Profile show a crown icon or “Premium” badge next to the username without page refresh.",
        "After subscribing, ad placeholders no longer render on Home (banner and inline) and any other ad placements are also hidden when `isPremium=true`.",
        "Profile includes \"Cancel Subscription\"; tapping it sets `isPremium=false`, removes the badge/crown, and ads reappear where applicable.",
        "If the UI has any premium-only story gating, the locked state is replaced by a placeholder message \"Premium unlocked\" when premium is active."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Add in-app sharing for both the overall app and individual stories with Web Share API support and a copy-link fallback.\n\nScope:\n- Add a \"Invite Friends – Share App\" button to the Profile page (near the bottom) or Home top area.\n  - On tap, use `navigator.share` when available with message:\n    \"Check out Global Tales Universe – Free multi-language stories app for adults & kids! Install here: [current app URL]\"\n    where [current app URL] is the runtime URL derived from the current window location.\n  - If `navigator.share` is not supported or fails, show a clear \"Copy link\" fallback that copies the app URL to clipboard and shows a confirmation toast.\n- For individual stories, enhance the existing share control on the StoryReader screen (currently uses ShareSheetPlaceholder) so that the share payload includes:\n  - story title\n  - a short preview (use the story summary if available; otherwise a safe truncated snippet)\n  - a link to the story page if stable, otherwise fall back to the app URL\n- Ensure the story share action works with apps like WhatsApp/Instagram via the system share dialog where supported.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "2. Share Button for App/Stories:\n   - Add \"Share App\" button...\n   - On tap for app share: Use navigator.share...\n   - For individual stories: Add share icon/button on story reading screen...\n   - Fallback: If navigator.share not supported, show copy link button."
        ]
      },
      "acceptanceCriteria": [
        "Profile (or Home) shows a visible button labeled exactly \"Invite Friends – Share App\".",
        "On supported browsers, tapping \"Invite Friends – Share App\" opens the native share dialog with the specified message and includes the current app URL.",
        "On unsupported browsers, tapping the share button provides a copy-link fallback that copies the URL and shows a success toast.",
        "StoryReader share button shares title + preview + URL using navigator.share when available, otherwise copies the story URL (or app URL fallback) to clipboard with a toast.",
        "No runtime errors occur when `navigator.share` or `navigator.clipboard` is unavailable; the UI presents a usable fallback."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Implement basic daily notifications / push alert simulation using the browser Notifications API with a Profile toggle and a test notification.\n\nScope:\n- Add a user-facing permission prompt either:\n  - on first app open, or\n  - in Profile as an explicit CTA\n  with the exact prompt text: \"Allow notifications for daily new stories?\".\n- Add a Profile setting toggle labeled exactly: \"Enable Daily Story Notifications\" (on/off).\n- When the user enables notifications:\n  - Request notification permission (if not already granted/denied).\n  - If permission is granted, immediately show a sample notification:\n    Title/body (single notification) must include the exact message:\n    \"New story added! Open app to read today's motivational tale.\"\n  - Persist the toggle state locally (guest localStorage and authenticated user state via useAppUser.updateUserState), and rehydrate it on reload.\n- If browser notifications are not supported or permission is denied:\n  - Keep the toggle in an off/disabled state with a clear inline explanation.\n  - Also show an in-app simulation on Home: a dismissible banner or badge reading exactly \"New story today!\" when notifications are enabled but real notifications cannot be shown.\n- Ensure service worker registration remains intact (do not break existing /sw.js registration).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "3. Daily Notifications / Push Alerts (basic setup for new story arrived):\n   - Add permission request: On first app open or Profile, show \"Allow notifications for daily new stories?\" prompt.\n   - Use browser Push API / Notifications API (service worker register if not already) for basic setup.\n   - Fake daily alert: When user allows, show sample notification \"New story added! Open app to read today's motivational tale.\" (test in preview).\n   - Add toggle in Profile: \"Enable Daily Story Notifications\" (on/off).\n   - If full push hard... add in-app badge or banner on home: \"New story today!\" for simulation."
        ]
      },
      "acceptanceCriteria": [
        "Profile contains a toggle labeled exactly \"Enable Daily Story Notifications\" and it persists across reloads.",
        "If Notification permission is not yet granted, enabling the toggle triggers a permission request flow.",
        "If permission is granted, a sample notification with the exact message \"New story added! Open app to read today's motivational tale.\" is shown immediately (suitable for preview testing).",
        "If Notifications API is unsupported or permission is denied, the UI provides a clear explanation and does not repeatedly re-prompt unexpectedly.",
        "When real notifications cannot be shown but the user wants daily notifications, Home displays an in-app simulation banner/badge labeled exactly \"New story today!\".",
        "Existing service worker registration remains functional and does not regress offline behavior."
      ]
    },
    {
      "id": "REQ-4",
      "text": "Maintain a clean, dark-themed, intuitive UI across the new Premium, Share, and Notifications controls.\n\nScope:\n- Keep the existing dark theme tokens/styles.\n- Ensure new buttons/toggles/success screens match existing spacing, typography, and component styles (use existing shadcn Button/Badge/Separator patterns).\n- Ensure new flows are testable in preview end-to-end: Premium subscribe/cancel, app share/story share (or copy link), notification permission + test notification.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "Keep dark theme, make UI clean and intuitive. Apply to current draft, update preview so I can test..."
        ]
      },
      "acceptanceCriteria": [
        "New screens and controls visually match the existing dark UI styling and component system.",
        "Premium flow is testable end-to-end in preview: open Premium → subscribe → see success → badge appears → ads hidden; cancel reverses.",
        "Share flow is testable end-to-end in preview: app share and story share trigger share dialog when supported or show copy fallback.",
        "Notifications flow is testable end-to-end in preview: toggle prompts permission and displays the sample notification when granted (or shows in-app simulation when not possible)."
      ]
    }
  ],
  "constraints": [
    "Do not implement real payments or integrate any payment provider; subscription is purely a placeholder.",
    "Do not add third-party auth; use existing Internet Identity only.",
    "Do not edit frontend immutable paths: frontend/src/hooks/useInternetIdentity.ts, frontend/src/hooks/useInternetIdentity.tsx, frontend/src/hooks/useActor.ts, frontend/src/main.tsx, frontend/src/components/ui (compose existing UI components instead).",
    "Backend remains single-actor; only add backend changes if strictly required for persisting authenticated users’ premium/notification preferences via existing AppUser fields."
  ],
  "nonGoals": [
    "Real premium billing, receipt validation, app store subscriptions, or Stripe integration.",
    "Server-driven push notifications with VAPID keys or scheduled jobs (true daily push).",
    "Social-media-specific SDK integrations for WhatsApp/Instagram; rely on system share sheet only.",
    "Adding new story content or changing story recommendation logic beyond premium-unlock placeholders."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}